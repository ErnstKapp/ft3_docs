

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>How to update a dapp chain &mdash; Rell v0.10.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/chromia-favicon.png"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="../_static/chromia-analytics.js"></script>
        <script async="async" src="../_static/custom.js"></script>
        <script src="../_static/dark-mode-on-load.js"></script>
        <script src="../_static/side-nav-icons.js"></script>
        <script src="../_static/get-news.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Single Sign-on (SSO)" href="ft3-single-sign-on.html" /> 
</head>

<body class="wy-body-for-nav">

  
<div class="dev-header">
    <nav class="chromia-nav">

        <a class="navbar-brand" href="https://chromia.com/developers/">
            <img class="nav-icon" src="../_static/dev-logo.svg" alt="Chromia Developers Logo">
        </a>

        <div class="chromia-nav-links">
                <div>
                    <a class="chromia-nav-link" href="https://chromia.com">Home</a>
                </div>
                <div>
                    <a class="chromia-nav-link" href="https://rell.chromia.com">Documentation</a>
                </div>
                <div>
                    <a class="chromia-nav-link" href="https://rellide-staging.chromia.dev/">Web IDE</a>
                </div>
                <div>
                    <a class="chromia-nav-link" href="https://t.me/ChromiaDev">Community</a>
                </div>
        </div>
        <i id="hamburger-menu" class="fa fa-bars"></i>
    </nav>
</div>

  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          
        <a class="main-logo" href="../index.html">
        <img src="../_static/chromia-logo.svg" class="logo" alt="Logo"/>
    </a>
    <div class="news-flash">
        <img class="news-icon" src="../_static/news-icon.svg">
    </div>

    <hr class="wy-side-hr">
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="ft3-features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="ft3-project-setup.html">Project Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="ft3-javascript-library.html">Javascript library</a></li>
<li class="toctree-l1"><a class="reference internal" href="ft3-rell-ft3-integration.html">Rell Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="ft3-single-sign-on.html">Single Sign-on (SSO)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">How to update a dapp chain</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
    <i data-toggle="wy-nav-top" id="menu-arrow-right" class="fa fa-angle-right"></i>
    <div class="dark-mode-container">
        <i class="moon-icon fa fa-moon-o"></i>
        <i data-toggle="dark-mode-toggle" class="dark-mode-toggler fa fa-toggle-off"></i>
    </div>
    <div class="wy-nav-top-title">
        <a href="../index.html">Rell</a>
    </div>
    <i id="search-button" class="fa fa-search"></i>
    <i data-toggle="wy-nav-top" id="menu-arrow-down" class="fa fa-angle-down"></i>
      </nav>


      <div class="wy-nav-content">
    <div class="wy-content-search">
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <i class="fa fa-search input-icon"></i>
    <input class="search-text" type="text" name="q" placeholder="Search documentation" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        <div class="dark-mode-container">
            <i class="moon-icon fa fa-moon-o"></i>
            <i data-toggle="dark-mode-toggle" class="dark-mode-toggler fa fa-toggle-off"></i>
        </div>
    </div>

    
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>How to update a dapp chain</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/ft3/ft3-updating-a-chain.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="how-to-update-a-dapp-chain">
<h1><a class="toc-backref" href="#id3">How to update a dapp chain</a><a class="headerlink" href="#how-to-update-a-dapp-chain" title="Permalink to this headline">¶</a></h1>
<p>Dapps evolve over time. And in this section, we discuss what to do in order to seamlessly update a dapp’s chain to new version.</p>
<p>There are 2 approaches to update a chain:</p>
<ul class="simple">
<li><p>Specify different config entry points for old and new versions, or</p></li>
<li><p>Reference compiled configuration of old version</p></li>
</ul>
<div class="section" id="project-structure-before-update">
<h2><a class="toc-backref" href="#id4">Project structure before update</a><a class="headerlink" href="#project-structure-before-update" title="Permalink to this headline">¶</a></h2>
<p>For both approaches, we will use an example project with a basic ft3 structure.</p>
<p>We have all of our chain’s code within <code class="docutils literal notranslate"><span class="pre">rell/src</span></code> folder:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>rell/src
      ├── lib
      │   ├── ft3
      │   └── … (other optional libraries)
      └── module.rell
</pre></div>
</div>
<p>And our <code class="docutils literal notranslate"><span class="pre">config.template.xml</span></code> should look like the following:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;run</span> <span class="na">wipe-db=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;nodes&gt;</span>
        <span class="nt">&lt;config</span> <span class="na">src=</span><span class="s">&quot;../../node-config.properties&quot;</span> <span class="na">add-signers=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/nodes&gt;</span>
    <span class="nt">&lt;chains&gt;</span>
        <span class="nt">&lt;chain</span> <span class="na">name=</span><span class="s">&quot;YOUR_CHAIN_NAME&quot;</span> <span class="na">iid=</span><span class="s">&quot;0&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;config</span> <span class="na">height=</span><span class="s">&quot;0&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;app</span> <span class="na">module=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;args</span> <span class="na">module=</span><span class="s">&quot;lib.ft3.core&quot;</span><span class="nt">&gt;</span>
                        <span class="c">&lt;!-- ... (your chain configs) --&gt;</span>
                    <span class="nt">&lt;/args&gt;</span>
                <span class="nt">&lt;/app&gt;</span>
            <span class="nt">&lt;/config&gt;</span>
        <span class="nt">&lt;/chain&gt;</span>
    <span class="nt">&lt;/chains&gt;</span>
<span class="nt">&lt;/run&gt;</span>
</pre></div>
</div>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#how-to-update-a-dapp-chain" id="id3">How to update a dapp chain</a></p>
<ul>
<li><p><a class="reference internal" href="#project-structure-before-update" id="id4">Project structure before update</a></p></li>
<li><p><a class="reference internal" href="#update-by-specifying-different-entry-points" id="id5">Update by specifying different entry points</a></p>
<ul>
<li><p><a class="reference internal" href="#restructure-the-code" id="id6">Restructure the code</a></p></li>
<li><p><a class="reference internal" href="#adding-new-codes" id="id7">Adding new codes</a></p></li>
<li><p><a class="reference internal" href="#set-the-migration-to-new-module" id="id8">Set the migration to new module</a></p></li>
<li><p><a class="reference internal" href="#test-the-chain" id="id9">Test the chain</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#update-by-referencing-old-configuration" id="id10">Update by referencing old configuration</a></p>
<ul>
<li><p><a class="reference internal" href="#what-does-run-node-sh-do" id="id11">What does run-node.sh do?</a></p></li>
<li><p><a class="reference internal" href="#backup-old-configuration" id="id12">Backup old configuration</a></p></li>
<li><p><a class="reference internal" href="#id1" id="id13">Adding new codes</a></p></li>
<li><p><a class="reference internal" href="#id2" id="id14">Set the migration to new module</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<hr class="docutils" />
<div class="section" id="update-by-specifying-different-entry-points">
<h2><a class="toc-backref" href="#id5">Update by specifying different entry points</a><a class="headerlink" href="#update-by-specifying-different-entry-points" title="Permalink to this headline">¶</a></h2>
<p>Use this approach when you want to have a clear overview of old version’s code.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>An example project to demonstrate this approach is available at branch <code class="docutils literal notranslate"><span class="pre">example/update-chain-keep-old-code</span></code> of <code class="docutils literal notranslate"><span class="pre">develop-chromia</span></code>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>git clone https://bitbucket.org/chromawallet/develop-chromia.git
git checkout example/update-chain-keep-old-code
</pre></div>
</div>
</div>
<div class="section" id="restructure-the-code">
<h3><a class="toc-backref" href="#id6">Restructure the code</a><a class="headerlink" href="#restructure-the-code" title="Permalink to this headline">¶</a></h3>
<p>As mentioned ealier, the target of this approach is to have clear overview of old code after several updates. So it might be considered good procedure to create different entry module for each chain version.</p>
<p>We will name each module with the current version tag, so that it will be clear what has been run in the past. After that, we will update the <code class="docutils literal notranslate"><span class="pre">config.template.xml</span></code> file by adding each version configuration and the height at which the changes will become effective.</p>
<p>The rell structure will then look like:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>rell/src
      └── v0_0_1
          ├── lib
          │   ├── ft3
          │   └── … (other optional libraries)
          └── module.rell
</pre></div>
</div>
<p>So essentially we just created a folder <code class="docutils literal notranslate"><span class="pre">v0_0_1</span></code> inside <code class="docutils literal notranslate"><span class="pre">src</span></code> and moved the all the previous files there.</p>
<p>We will need to update the <code class="docutils literal notranslate"><span class="pre">config.template.xml</span></code> file to reflect this change. Note the change at <code class="docutils literal notranslate"><span class="pre">&lt;app&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;arg&gt;</span></code> tags:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;run</span> <span class="na">wipe-db=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;nodes&gt;</span>
        <span class="nt">&lt;config</span> <span class="na">src=</span><span class="s">&quot;../../node-config.properties&quot;</span> <span class="na">add-signers=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/nodes&gt;</span>
    <span class="nt">&lt;chains&gt;</span>
        <span class="nt">&lt;chain</span> <span class="na">name=</span><span class="s">&quot;YOUR_CHAIN_NAME&quot;</span> <span class="na">iid=</span><span class="s">&quot;0&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;config</span> <span class="na">height=</span><span class="s">&quot;0&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;app</span> <span class="na">module=</span><span class="s">&quot;v0_0_1&quot;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;args</span> <span class="na">module=</span><span class="s">&quot;v0_0_1.lib.ft3.core&quot;</span><span class="nt">&gt;</span>
                        <span class="c">&lt;!-- ... (your chain configs) --&gt;</span>
                    <span class="nt">&lt;/args&gt;</span>
                <span class="nt">&lt;/app&gt;</span>
            <span class="nt">&lt;/config&gt;</span>
        <span class="nt">&lt;/chain&gt;</span>
    <span class="nt">&lt;/chains&gt;</span>
<span class="nt">&lt;/run&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As a matter of information, the project’s entry path is specified under postchain/config/nodes/dev/blockchains/app/entry-file.txt.</p>
</div>
<p>Confirm the new configuration is working properly by starting the chain:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>./postchain/bin/run-node.sh dev
</pre></div>
</div>
</div>
<div class="section" id="adding-new-codes">
<h3><a class="toc-backref" href="#id7">Adding new codes</a><a class="headerlink" href="#adding-new-codes" title="Permalink to this headline">¶</a></h3>
<p>Now that we have restructured the code, we can upgrade the code. To do that we copy <code class="docutils literal notranslate"><span class="pre">v0_0_1</span></code> folder and rename it <code class="docutils literal notranslate"><span class="pre">v0_0_2</span></code>.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>rell/src
      ├── v0_0_1
      │   ├── lib
      │   │   ├── ft3
      │   │   └── … (other optional libraries)
      │   └── module.rell
      │
      └── v0_0_2
          ├── lib
          │   ├── ft3
          │   └── … (other optional libraries)
          └── module.rell
</pre></div>
</div>
<p>For easy testing, we can add one new query in the <code class="docutils literal notranslate"><span class="pre">module.rell</span></code> file of <code class="docutils literal notranslate"><span class="pre">v0_0_2</span></code>:</p>
<div class="highlight-rell notranslate"><div class="highlight"><pre><span></span><span class="k">module</span><span class="p">;</span>

<span class="k">import</span> <span class="nv">lf</span><span class="p">:</span> <span class="p">.</span><span class="nv">lib</span><span class="p">.</span><span class="nv">ft3</span><span class="p">.</span><span class="nv">ft3_basic_dev</span><span class="p">;</span>

<span class="k">query</span> <span class="nv">get_version</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="s">&quot;0.0.2&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If everything works correctly we will not receive any response when running the module <code class="docutils literal notranslate"><span class="pre">v0_0_1</span></code> but we will receive <code class="docutils literal notranslate"><span class="pre">0_0_2</span></code> when running the module <code class="docutils literal notranslate"><span class="pre">v0_0_2</span></code>.</p>
</div>
<div class="section" id="set-the-migration-to-new-module">
<h3><a class="toc-backref" href="#id8">Set the migration to new module</a><a class="headerlink" href="#set-the-migration-to-new-module" title="Permalink to this headline">¶</a></h3>
<p>To migrate to the new module, we need to update the <code class="docutils literal notranslate"><span class="pre">config.template.xml</span></code> file.</p>
<p>We will add a new <code class="docutils literal notranslate"><span class="pre">&lt;config&gt;</span></code> tag inside our <code class="docutils literal notranslate"><span class="pre">&lt;chain&gt;</span></code>, and set it to be enabled at a certain (block) <code class="docutils literal notranslate"><span class="pre">height</span></code>:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;run</span> <span class="na">wipe-db=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;nodes&gt;</span>
        <span class="nt">&lt;config</span> <span class="na">src=</span><span class="s">&quot;../../node-config.properties&quot;</span> <span class="na">add-signers=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/nodes&gt;</span>
    <span class="nt">&lt;chains&gt;</span>
        <span class="nt">&lt;chain</span> <span class="na">name=</span><span class="s">&quot;YOUR_CHAIN_NAME&quot;</span> <span class="na">iid=</span><span class="s">&quot;0&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;config</span> <span class="na">height=</span><span class="s">&quot;0&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;app</span> <span class="na">module=</span><span class="s">&quot;v0_0_1&quot;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;args</span> <span class="na">module=</span><span class="s">&quot;v0_0_1.lib.ft3.core&quot;</span><span class="nt">&gt;</span>
                        <span class="c">&lt;!-- ... (your chain configs) --&gt;</span>
                    <span class="nt">&lt;/args&gt;</span>
                <span class="nt">&lt;/app&gt;</span>
            <span class="nt">&lt;/config&gt;</span>
            <span class="nt">&lt;config</span> <span class="na">height=</span><span class="s">&quot;20&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;app</span> <span class="na">module=</span><span class="s">&quot;v0_0_2&quot;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;args</span> <span class="na">module=</span><span class="s">&quot;v0_0_2.lib.ft3.core&quot;</span><span class="nt">&gt;</span>
                        <span class="c">&lt;!-- ... (your chain configs) --&gt;</span>
                    <span class="nt">&lt;/args&gt;</span>
                <span class="nt">&lt;/app&gt;</span>
            <span class="nt">&lt;/config&gt;</span>
        <span class="nt">&lt;/chain&gt;</span>
    <span class="nt">&lt;/chains&gt;</span>
<span class="nt">&lt;/run&gt;</span>
</pre></div>
</div>
<p>In this example, after 20 blocks the chain will change app module to <code class="docutils literal notranslate"><span class="pre">v0_0_2</span></code>.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Ensure that the block height for the new configuration is safely higher than current height.</p>
<p>Setting a block height that is lower than current height might cause problems to nodes that want to sync by re-applying all the transactions.</p>
</div>
</div>
<div class="section" id="test-the-chain">
<h3><a class="toc-backref" href="#id9">Test the chain</a><a class="headerlink" href="#test-the-chain" title="Permalink to this headline">¶</a></h3>
<p>Start our chain with</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>./postchain/bin/run-node.sh dev
</pre></div>
</div>
<p>Recall the new query <code class="docutils literal notranslate"><span class="pre">get_version()</span></code> we created earlier. We can test the chain’s version with a simple script such as:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">pcl</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;postchain-client&#39;</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">node_api_url</span> <span class="o">=</span> <span class="s2">&quot;http://localhost:YOUR_NODE_PORT&quot;</span><span class="p">;</span>

<span class="c1">// default blockchain identifier used for testing</span>
<span class="kd">const</span> <span class="nx">blockchainRID</span> <span class="o">=</span> <span class="nx">YOUR_NODE_BRID</span><span class="p">;</span>


<span class="kd">const</span> <span class="nx">rest</span> <span class="o">=</span> <span class="nx">pcl</span><span class="p">.</span><span class="nx">restClient</span><span class="p">.</span><span class="nx">createRestClient</span><span class="p">(</span><span class="nx">node_api_url</span><span class="p">,</span> <span class="nx">blockchainRID</span><span class="p">,</span> <span class="mf">5</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">gtvHash</span> <span class="o">=</span> <span class="nx">pcl</span><span class="p">.</span><span class="nx">gtv</span><span class="p">.</span><span class="nx">gtvHash</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">gtx</span> <span class="o">=</span> <span class="nx">pcl</span><span class="p">.</span><span class="nx">gtxClient</span><span class="p">.</span><span class="nx">createClient</span><span class="p">(</span>
    <span class="nx">rest</span><span class="p">,</span>
    <span class="nx">Buffer</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">blockchainRID</span><span class="p">,</span> <span class="s1">&#39;hex&#39;</span><span class="p">),</span>
    <span class="p">[]</span> <span class="p">);</span>


<span class="kd">const</span> <span class="nx">gtv</span> <span class="o">=</span> <span class="nx">pcl</span><span class="p">.</span><span class="nx">gtv</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">gtxU</span> <span class="o">=</span> <span class="nx">pcl</span><span class="p">.</span><span class="nx">gtx</span><span class="p">;</span>

<span class="p">(</span> <span class="k">async</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">version</span> <span class="o">=</span>  <span class="k">await</span> <span class="nx">gtx</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="s2">&quot;get_version&quot;</span><span class="p">,</span> <span class="p">{});</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;New version not yet implemented&quot;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">version</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`New version running: </span><span class="si">${</span><span class="nx">version</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>

<span class="p">})();</span>
</pre></div>
</div>
<p>We can monitor the blockchain by linking it to the <a class="reference external" href="https://explorer-testnet.chromia.com/">Explorer</a> :</p>
<p><img alt="Update A Chain" src="../_images/update-chain.png" /></p>
<p>At block 20 we will start getting a result back from the chain. It will return something like:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>POST URL http://localhost:7743/query/A54320E7D063AB94513467806FE800A1B95B26BF65C4F11D30C5D65859E4025C

0.0.2
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="update-by-referencing-old-configuration">
<h2><a class="toc-backref" href="#id10">Update by referencing old configuration</a><a class="headerlink" href="#update-by-referencing-old-configuration" title="Permalink to this headline">¶</a></h2>
<p>The second approach that can be used is to specify previous compiled configurations in the config tag.</p>
<p>Use this approach if you want cleaner code structure.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>An example project to demonstrate this approach is available at branch <code class="docutils literal notranslate"><span class="pre">feature/CCD210-update-chain-tutorial</span></code> of <code class="docutils literal notranslate"><span class="pre">develop-chromia</span></code>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>git clone https://bitbucket.org/chromawallet/develop-chromia.git
git checkout feature/CCD210-update-chain-tutorial
</pre></div>
</div>
</div>
<div class="section" id="what-does-run-node-sh-do">
<h3><a class="toc-backref" href="#id11">What does run-node.sh do?</a><a class="headerlink" href="#what-does-run-node-sh-do" title="Permalink to this headline">¶</a></h3>
<p>In order to discuss this approach, we must first explain what happened when you execute <code class="docutils literal notranslate"><span class="pre">./postchain/bin/run-node.sh</span> <span class="pre">dev</span></code> in the console.</p>
<p>This command does 3 things.</p>
<ol class="arabic simple">
<li><p>First it creates a target folder where the compiled blockchain configuration will be placed, something like:</p></li>
</ol>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>mkdir -p ./postchain/runtime/nodes/dev
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Then it generates the blockchain configuration by compiling the rell code with the <code class="docutils literal notranslate"><span class="pre">config.template.xml</span></code> file.</p></li>
</ol>
<p>If it is a new chain (e.g. started with the <code class="docutils literal notranslate"><span class="pre">-W</span></code> option), the BRID is also generated at this step. Since we are dicussing updating a chain here, we don’t want the BRID to change, so <code class="docutils literal notranslate"><span class="pre">-W</span></code> option should never be called while updating.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>./postchain/lib/multigen.sh ./postchain/config/nodes/dev/blockchains/app/config.template.xml -d ./rell/src -o ./postchain/runtime/nodes/dev/
</pre></div>
</div>
<p>It should create the following architecture inside <code class="docutils literal notranslate"><span class="pre">postchain/runtime/nodes/dev</span></code>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>postchain/runtime/nodes/dev
├── blockchains
│   └── 0
│       ├── 0.gtv (creates a one file rell module)
│       ├── 0.xml (creates the configuration that will be run, also by using the just created 0.gtv)
│       └── brid.txt (just a file where is output the brid of the chain, n.b. it will remain constant nevertheless the updates)
│
├── node-config.properties
└── private.properties
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Finally, it runs the new configuration with</p></li>
</ol>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>./postchain/lib/postchain.sh run-node-auto -d ./postchain/runtime/nodes/dev
</pre></div>
</div>
</div>
<div class="section" id="backup-old-configuration">
<h3><a class="toc-backref" href="#id12">Backup old configuration</a><a class="headerlink" href="#backup-old-configuration" title="Permalink to this headline">¶</a></h3>
<p>Compile the current code (by executing <code class="docutils literal notranslate"><span class="pre">./postchain/bin/run-node.sh</span> <span class="pre">dev</span></code> or only step 1 and 2 described above).</p>
<p>In the generated configuration folder, copy <code class="docutils literal notranslate"><span class="pre">runtime/nodes/dev/0.xml</span></code> into <code class="docutils literal notranslate"><span class="pre">postchain/config/nodes/dev/blockchains/app</span></code>, and rename it <code class="docutils literal notranslate"><span class="pre">0.0.1.xml</span></code></p>
</div>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id13">Adding new codes</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>In the previous approach, we were keeping track from a code point of view of previous versions. This time we will not do that, so we can change the current code directly without copying anything.</p>
<p>Let’s just add the query into the <code class="docutils literal notranslate"><span class="pre">module.rell</span></code> file:</p>
<div class="highlight-rell notranslate"><div class="highlight"><pre><span></span><span class="k">module</span><span class="p">;</span>

<span class="k">import</span> <span class="nv">lf</span><span class="p">:</span> <span class="p">.</span><span class="nv">lib</span><span class="p">.</span><span class="nv">ft3</span><span class="p">.</span><span class="nv">ft3_basic_dev</span><span class="p">;</span>

<span class="k">query</span> <span class="nv">get_version</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="s">&quot;0.0.2&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h3><a class="toc-backref" href="#id14">Set the migration to new module</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>Update the <code class="docutils literal notranslate"><span class="pre">config.template.xml</span></code> file to config the migration.</p>
<p>Note that unlike the other approach, this time we don’t have to change the <code class="docutils literal notranslate"><span class="pre">&lt;app&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;args&gt;</span></code> tags:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;run</span> <span class="na">wipe-db=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;nodes&gt;</span>
        <span class="nt">&lt;config</span> <span class="na">src=</span><span class="s">&quot;../../node-config.properties&quot;</span> <span class="na">add-signers=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/nodes&gt;</span>
    <span class="nt">&lt;chains&gt;</span>
        <span class="nt">&lt;chain</span> <span class="na">name=</span><span class="s">&quot;YOUR_CHAIN_NAME&quot;</span> <span class="na">iid=</span><span class="s">&quot;0&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;config</span> <span class="na">height=</span><span class="s">&quot;0&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;gtv</span> <span class="na">src=</span><span class="s">&quot;0.0.1.xml&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/config&gt;</span>
            <span class="nt">&lt;config</span> <span class="na">height=</span><span class="s">&quot;20&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;app</span> <span class="na">module=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;args</span> <span class="na">module=</span><span class="s">&quot;lib.ft3.core&quot;</span><span class="nt">&gt;</span>
                        <span class="c">&lt;!-- ... (your chain configs) --&gt;</span>
                    <span class="nt">&lt;/args&gt;</span>
                <span class="nt">&lt;/app&gt;</span>
            <span class="nt">&lt;/config&gt;</span>
        <span class="nt">&lt;/chain&gt;</span>
    <span class="nt">&lt;/chains&gt;</span>
<span class="nt">&lt;/run&gt;</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Ensure that the block height for the new configuration is safely higher than current height.</p>
<p>Setting a block height that is lower than current height might cause problems to nodes that want to sync by re-applying all the transactions.</p>
</div>
<p>Compile the new configuration and start the chain:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>./postchain/bin/run-node.sh dev
</pre></div>
</div>
<p>We can now <a class="reference internal" href="#test-the-chain">Test the chain</a> as before. If we try to query for <code class="docutils literal notranslate"><span class="pre">get_version()</span></code> after block 20 we will see <code class="docutils literal notranslate"><span class="pre">0.0.2</span></code>.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="ft3-single-sign-on.html" class="btn btn-neutral float-left" title="Single Sign-on (SSO)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
    <script src="../_static/side-nav-icons.js"></script>
    <script src="../_static/dark-mode-on-load.js"></script>
    <script src="../_static/get-news.js"></script>


</body>
</html>