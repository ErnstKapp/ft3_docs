

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Converting Chromia-Chat to FT3 &mdash; Rell v0.10.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/chromia-favicon.png"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="../_static/chromia-analytics.js"></script>
        <script async="async" src="../_static/custom.js"></script>
        <script src="../_static/dark-mode-on-load.js"></script>
        <script src="../_static/side-nav-icons.js"></script>
        <script src="../_static/get-news.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

  
<div class="dev-header">
    <nav class="chromia-nav">

        <a class="navbar-brand" href="https://chromia.com/developers/">
            <img class="nav-icon" src="../_static/dev-logo.svg" alt="Chromia Developers Logo">
        </a>

        <div class="chromia-nav-links">
                <div>
                    <a class="chromia-nav-link" href="https://chromia.com">Home</a>
                </div>
                <div>
                    <a class="chromia-nav-link" href="https://rell.chromia.com">Documentation</a>
                </div>
                <div>
                    <a class="chromia-nav-link" href="https://rellide-staging.chromia.dev/">Web IDE</a>
                </div>
                <div>
                    <a class="chromia-nav-link" href="https://t.me/ChromiaDev">Community</a>
                </div>
        </div>
        <i id="hamburger-menu" class="fa fa-bars"></i>
    </nav>
</div>

  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          
        <a class="main-logo" href="../index.html">
        <img src="../_static/chromia-logo.svg" class="logo" alt="Logo"/>
    </a>
    <div class="news-flash">
        <img class="news-icon" src="../_static/news-icon.svg">
    </div>

    <hr class="wy-side-hr">
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="ft3-features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="ft3-project-setup.html">Project Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="ft3-javascript-library.html">Javascript library</a></li>
<li class="toctree-l1"><a class="reference internal" href="ft3-rell-ft3-integration.html">Rell Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="ft3-single-sign-on.html">Single Sign-on (SSO)</a></li>
<li class="toctree-l1"><a class="reference internal" href="ft3-updating-a-chain.html">How to update a dapp chain</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
    <i data-toggle="wy-nav-top" id="menu-arrow-right" class="fa fa-angle-right"></i>
    <div class="dark-mode-container">
        <i class="moon-icon fa fa-moon-o"></i>
        <i data-toggle="dark-mode-toggle" class="dark-mode-toggler fa fa-toggle-off"></i>
    </div>
    <div class="wy-nav-top-title">
        <a href="../index.html">Rell</a>
    </div>
    <i id="search-button" class="fa fa-search"></i>
    <i data-toggle="wy-nav-top" id="menu-arrow-down" class="fa fa-angle-down"></i>
      </nav>


      <div class="wy-nav-content">
    <div class="wy-content-search">
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <i class="fa fa-search input-icon"></i>
    <input class="search-text" type="text" name="q" placeholder="Search documentation" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        <div class="dark-mode-container">
            <i class="moon-icon fa fa-moon-o"></i>
            <i data-toggle="dark-mode-toggle" class="dark-mode-toggler fa fa-toggle-off"></i>
        </div>
    </div>

    
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Converting Chromia-Chat to FT3</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/ft3/ft3-chromia-chat.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="converting-chromia-chat-to-ft3">
<h1>Converting Chromia-Chat to FT3<a class="headerlink" href="#converting-chromia-chat-to-ft3" title="Permalink to this headline">¶</a></h1>
<p>In this section, we will “upgrade” the <span class="xref std std-doc">Chromia Chat Example Project</span> into a version that uses FT3.</p>
<p>First of all, lets change the user entity to be identified by an account instead of a public key.</p>
<div class="highlight-rell notranslate"><div class="highlight"><pre><span></span><span class="k">entity</span> <span class="nv">user</span><span class="p">{</span>
     <span class="k">key</span> <span class="nv">account</span> <span class="p">:</span> <span class="nv">lf</span><span class="p">.</span><span class="nv">ft3</span><span class="p">.</span><span class="nv">acc</span><span class="p">.</span><span class="nv">account</span><span class="p">;</span>
     <span class="k">key</span> <span class="nv">name</span> <span class="p">:</span> <span class="nv">text</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Our functions in Rell will no longer have a pubkey as the identifier of users, instead we will pass
the account of users as parameters when writing functions. Instead of checking signers in the function, we
will also use auth_log to make sure the right account is using the function:</p>
<div class="highlight-rell notranslate"><div class="highlight"><pre><span></span><span class="k">operation</span> <span class="nv">init</span><span class="p">(</span><span class="nv">founder_auth</span><span class="p">:</span> <span class="nv">acc</span><span class="p">.</span><span class="nv">auth_descriptor</span><span class="p">){</span>
     <span class="nv">require</span><span class="p">(</span> <span class="p">(</span><span class="nv">user</span><span class="p">@</span><span class="o">*</span><span class="p">{}</span> <span class="k">limit</span> <span class="mi">1</span><span class="p">).</span><span class="nv">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
     <span class="k">val</span> <span class="nv">account_id</span> <span class="o">=</span> <span class="nv">acc</span><span class="p">.</span><span class="nv">create_account_with_auth</span><span class="p">(</span><span class="nv">founder_auth</span><span class="p">);</span>
     <span class="k">val</span> <span class="nv">founder</span> <span class="o">=</span> <span class="k">create</span> <span class="nv">user</span> <span class="p">(</span><span class="nv">account_id</span><span class="p">,</span> <span class="s">&quot;admin&quot;</span><span class="p">);</span>
     <span class="k">create</span> <span class="nv">balance</span> <span class="p">(</span><span class="nv">founder</span><span class="p">,</span> <span class="mi">100000</span><span class="p">);</span>
     <span class="p">}</span>
</pre></div>
</div>
<div class="highlight-rell notranslate"><div class="highlight"><pre><span></span><span class="k">operation</span> <span class="nv">add_channel_member</span><span class="p">(</span>
          <span class="nv">admin_auth</span><span class="p">:</span> <span class="nv">acc</span><span class="p">.</span><span class="nv">auth_descriptor</span><span class="p">,</span>
          <span class="nv">channel_name</span><span class="p">:</span> <span class="nv">name</span><span class="p">,</span><span class="nv">member_username</span><span class="p">:</span> <span class="nv">text</span>
           <span class="p">){</span>
    <span class="nv">auth_and_log</span><span class="p">(</span><span class="nv">get_account_by_auth_descriptor</span><span class="p">(</span><span class="nv">admin_auth</span><span class="p">),</span>
                 <span class="nv">admin_auth</span><span class="p">.</span><span class="nv">hash</span><span class="p">(),</span> <span class="p">[</span><span class="nv">flagType</span><span class="p">.</span><span class="nv">Account</span><span class="p">,</span> <span class="nv">flagType</span><span class="p">.</span><span class="nv">Transaction</span><span class="p">]</span>
                 <span class="p">);</span>
    <span class="k">val</span> <span class="nv">admin_usr</span> <span class="o">=</span> <span class="nv">user</span><span class="p">@{</span><span class="nv">admin_account</span><span class="p">};</span>
    <span class="nv">pay_fee</span><span class="p">(</span><span class="nv">admin_usr</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">val</span> <span class="nv">channel</span> <span class="o">=</span> <span class="nv">channel</span><span class="p">@{</span><span class="nv">channel_name</span><span class="p">,</span> <span class="p">.</span><span class="nv">admin</span><span class="o">==</span><span class="nv">user</span><span class="p">@{</span><span class="nv">admin_account</span><span class="p">}};</span>
    <span class="k">create</span> <span class="nv">channel_member</span> <span class="p">(</span><span class="nv">channel</span><span class="p">,</span> <span class="nv">member</span><span class="o">=</span><span class="nv">user</span><span class="p">@{.</span><span class="nv">username</span> <span class="o">==</span> <span class="nv">member_username</span><span class="p">});</span>
    <span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="client-side">
<h1>Client Side<a class="headerlink" href="#client-side" title="Permalink to this headline">¶</a></h1>
<p>In our client side we will import the required ft3 dependencies and our constants</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">pcl</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;postchain-client&#39;</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">crypto</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;crypto&#39;</span><span class="p">)</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">Postchain</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;ft3-lib&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">blockchainRID</span><span class="p">,</span> <span class="nx">blockchainUrl</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;./configs/constants&#39;</span><span class="p">;</span> <span class="c1">// these configs are set in previous section</span>
<span class="k">import</span> <span class="p">{</span>
<span class="nx">op</span><span class="p">,</span>
<span class="nx">Blockchain</span><span class="p">,</span>
<span class="nx">SingleSignatureAuthDescriptor</span><span class="p">,</span>
<span class="nx">FlagsType</span><span class="p">,</span>
<span class="nx">User</span>
<span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;ft3-lib&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>And also initialize the blockchain:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">blockchain</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">Blockchain</span><span class="p">.</span><span class="nx">initialize</span><span class="p">(</span>
<span class="nx">blockchainRID</span><span class="p">,</span>
<span class="k">new</span> <span class="nx">DirectoryService</span><span class="p">()</span>
<span class="p">);</span>
</pre></div>
</div>
<p>For our Javascript frontend, the init function will take the admins auth descriptor as an argument.
For this we will make a new single signature auth descriptor and admin user</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">adminKeyPair</span> <span class="o">=</span> <span class="nx">util</span><span class="p">.</span><span class="nx">makeKeyPair</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">admin</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">(</span>
        <span class="nx">adminKeyPair</span><span class="p">,</span>
        <span class="k">new</span> <span class="nx">SingleSignatureAuthDescriptor</span><span class="p">(</span>
                <span class="nx">adminKeyPair</span><span class="p">.</span><span class="nx">pubKey</span><span class="p">,</span>
                <span class="p">[</span><span class="nx">FlagsType</span><span class="p">.</span><span class="nx">Account</span><span class="p">,</span> <span class="nx">FlagsType</span><span class="p">.</span><span class="nx">Transfer</span><span class="p">]</span>
                <span class="p">)</span>
        <span class="p">);</span>
</pre></div>
</div>
<p>And then we start a new session on the blockchain with admin</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">session</span> <span class="o">=</span> <span class="nx">blockchain</span><span class="p">.</span><span class="nx">newSession</span><span class="p">(</span><span class="nx">admin</span><span class="p">);</span>
</pre></div>
</div>
<p>On the session we will call on the Rell init operation
.. code-block:: javascript</p>
<blockquote>
<div><p>await session.call(op(‘init’, admin.authDescriptor));</p>
</div></blockquote>
<p>For our functions like create channel we will use the same method of using session.call for communication with our Rell backend</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="kd">function</span> <span class="nx">registerUser</span><span class="p">(</span><span class="nx">existing_user</span><span class="p">,</span> <span class="nx">new_user_keyPair</span><span class="p">,</span> <span class="nx">new_user_name</span><span class="p">,</span> <span class="nx">fee</span><span class="p">){</span>
     <span class="kd">const</span> <span class="nx">auth_descriptor</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SingleSignatureAuthDescriptor</span><span class="p">(</span>
             <span class="nx">new_user_keyPair</span><span class="p">.</span><span class="nx">pubKey</span><span class="p">,</span>
             <span class="p">[</span><span class="nx">FlagsType</span><span class="p">.</span><span class="nx">Account</span><span class="p">,</span> <span class="nx">FlagsType</span><span class="p">.</span><span class="nx">Transfer</span><span class="p">]</span>
             <span class="p">);</span>
     <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">(</span><span class="nx">authDescriptor</span><span class="p">,</span> <span class="nx">new_user_keyPair</span><span class="p">);</span>
     <span class="kd">const</span> <span class="nx">session</span> <span class="o">=</span> <span class="nx">blockchain</span><span class="p">.</span><span class="nx">newSession</span><span class="p">(</span><span class="nx">existing_user</span><span class="p">);</span>
     <span class="k">await</span> <span class="nx">session</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">op</span><span class="p">(</span><span class="s1">&#39;register_user&#39;</span><span class="p">,</span> <span class="nx">existing_user</span><span class="p">,</span> <span class="nx">user</span><span class="p">.</span><span class="nx">authDescriptor</span><span class="p">,</span> <span class="nx">new_user_name</span><span class="p">,</span> <span class="nx">fee</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
    <script src="../_static/side-nav-icons.js"></script>
    <script src="../_static/dark-mode-on-load.js"></script>
    <script src="../_static/get-news.js"></script>


</body>
</html>