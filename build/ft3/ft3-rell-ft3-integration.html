

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Rell Integration &mdash; Rell v0.10.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/chromia-favicon.png"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script async="async" src="../_static/chromia-analytics.js"></script>
        <script async="async" src="../_static/custom.js"></script>
        <script src="../_static/dark-mode-on-load.js"></script>
        <script src="../_static/side-nav-icons.js"></script>
        <script src="../_static/get-news.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Single Sign-on (SSO)" href="ft3-single-sign-on.html" />
    <link rel="prev" title="Javascript library" href="ft3-javascript-library.html" /> 
</head>

<body class="wy-body-for-nav">

  
<div class="dev-header">
    <nav class="chromia-nav">

        <a class="navbar-brand" href="https://chromia.com/developers/">
            <img class="nav-icon" src="../_static/dev-logo.svg" alt="Chromia Developers Logo">
        </a>

        <div class="chromia-nav-links">
                <div>
                    <a class="chromia-nav-link" href="https://chromia.com">Home</a>
                </div>
                <div>
                    <a class="chromia-nav-link" href="https://rell.chromia.com">Documentation</a>
                </div>
                <div>
                    <a class="chromia-nav-link" href="https://rellide-staging.chromia.dev/">Web IDE</a>
                </div>
                <div>
                    <a class="chromia-nav-link" href="https://t.me/ChromiaDev">Community</a>
                </div>
        </div>
        <i id="hamburger-menu" class="fa fa-bars"></i>
    </nav>
</div>

  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          
        <a class="main-logo" href="../index.html">
        <img src="../_static/chromia-logo.svg" class="logo" alt="Logo"/>
    </a>
    <div class="news-flash">
        <img class="news-icon" src="../_static/news-icon.svg">
    </div>

    <hr class="wy-side-hr">
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="ft3-features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="ft3-project-setup.html">Project Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="ft3-javascript-library.html">Javascript library</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Rell Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="ft3-single-sign-on.html">Single Sign-on (SSO)</a></li>
<li class="toctree-l1"><a class="reference internal" href="ft3-updating-a-chain.html">How to update a dapp chain</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
    <i data-toggle="wy-nav-top" id="menu-arrow-right" class="fa fa-angle-right"></i>
    <div class="dark-mode-container">
        <i class="moon-icon fa fa-moon-o"></i>
        <i data-toggle="dark-mode-toggle" class="dark-mode-toggler fa fa-toggle-off"></i>
    </div>
    <div class="wy-nav-top-title">
        <a href="../index.html">Rell</a>
    </div>
    <i id="search-button" class="fa fa-search"></i>
    <i data-toggle="wy-nav-top" id="menu-arrow-down" class="fa fa-angle-down"></i>
      </nav>


      <div class="wy-nav-content">
    <div class="wy-content-search">
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <i class="fa fa-search input-icon"></i>
    <input class="search-text" type="text" name="q" placeholder="Search documentation" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        <div class="dark-mode-container">
            <i class="moon-icon fa fa-moon-o"></i>
            <i data-toggle="dark-mode-toggle" class="dark-mode-toggler fa fa-toggle-off"></i>
        </div>
    </div>

    
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Rell Integration</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/ft3/ft3-rell-ft3-integration.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="rell-integration">
<h1>Rell Integration<a class="headerlink" href="#rell-integration" title="Permalink to this headline">¶</a></h1>
<p>In the bootstrap project, <code class="docutils literal notranslate"><span class="pre">rell/src</span></code> directory is configurated to be the rell project’s root module. <code class="docutils literal notranslate"><span class="pre">rell/src/lib/ft3</span></code> directory contains the FT3 module.</p>
<p>We also provided a <code class="docutils literal notranslate"><span class="pre">rell/src/module.rell</span></code> file with some template code which could serve as an entry point for your dapp, although you are free to choose any module structure to your liking.</p>
<div class="section" id="defining-dapp-account-entity">
<h2>Defining dapp_account entity<a class="headerlink" href="#defining-dapp-account-entity" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">account</span></code> entity provided by <code class="docutils literal notranslate"><span class="pre">.lib.ft3.account</span></code> module can be used for account management. But your dapp might need to record more information about the user, like username, email address, etc. We can add an an entity to record those information.</p>
<p>An example dapp’s account could be defined as:</p>
<div class="highlight-rell notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nv">acc</span><span class="p">:</span> <span class="p">.</span><span class="nv">lib</span><span class="p">.</span><span class="nv">ft3</span><span class="p">.</span><span class="nv">account</span><span class="p">;</span>

<span class="k">entity</span> <span class="nv">dapp_account</span> <span class="p">{</span>
  <span class="k">key</span> <span class="nv">account</span><span class="p">:</span> <span class="nv">acc</span><span class="p">.</span><span class="nv">account</span><span class="p">;</span>
  <span class="k">key</span> <span class="nv">first_name</span><span class="p">:</span> <span class="nv">text</span><span class="p">;</span>
  <span class="k">key</span> <span class="nv">last_name</span><span class="p">:</span> <span class="nv">text</span><span class="p">;</span>
  <span class="k">index</span> <span class="nv">age</span><span class="p">:</span> <span class="nv">integer</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In this user model, there is no public key or user ID. Those details are provided by <code class="docutils literal notranslate"><span class="pre">acc.account</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">acc.account</span></code> has an <code class="docutils literal notranslate"><span class="pre">id</span></code> property which uniquely identifies an account, and access is controlled by <code class="docutils literal notranslate"><span class="pre">acc.account_auth_descriptor</span></code> which include user’s public key.</p>
<p>The underlying structure of <code class="docutils literal notranslate"><span class="pre">acc.account</span></code> and <code class="docutils literal notranslate"><span class="pre">acc.account_auth_descriptor</span></code> is explained in <a class="reference internal" href="ft3-features.html#ft3-account-management"><span class="std std-ref">Account Management</span></a>.</p>
<p>After <code class="docutils literal notranslate"><span class="pre">dapp_account</span></code> entity is defined, the next step is to define operation used to create an instance of <code class="docutils literal notranslate"><span class="pre">dapp_account</span></code>:</p>
<div class="highlight-rell notranslate"><div class="highlight"><pre><span></span><span class="k">operation</span> <span class="nv">create_dapp_account</span><span class="p">(</span>
  <span class="nv">firstname</span><span class="p">:</span> <span class="nv">text</span><span class="p">,</span>
  <span class="nv">lastname</span><span class="p">:</span> <span class="nv">text</span><span class="p">;</span>
  <span class="nv">age</span><span class="p">:</span> <span class="nv">integer</span><span class="p">;</span>
  <span class="nv">user_auth</span><span class="p">:</span> <span class="nv">acc</span><span class="p">.</span><span class="nv">auth_descriptor</span>
<span class="p">)</span> <span class="p">{</span>
  <span class="k">val</span> <span class="nv">account_id</span> <span class="o">=</span> <span class="nv">acc</span><span class="p">.</span><span class="nv">create_account_with_auth</span><span class="p">(</span><span class="nv">user_auth</span><span class="p">);</span>
  <span class="k">create</span> <span class="nv">dapp_account</span> <span class="p">(</span>
    <span class="nv">first_name</span> <span class="o">=</span> <span class="nv">firstname</span><span class="p">,</span>
    <span class="nv">last_name</span> <span class="o">=</span> <span class="nv">lastname</span><span class="p">,</span>
    <span class="nv">age</span><span class="p">,</span>
    <span class="nv">acc</span><span class="p">.</span><span class="nv">account</span> <span class="p">@</span> <span class="p">{</span> <span class="nv">account_id</span> <span class="p">}</span>
  <span class="p">);</span>
<span class="p">}</span>

<span class="k">query</span> <span class="nv">get_dapp_accounts</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nv">dapp_account</span> <span class="p">@</span><span class="o">?</span> <span class="p">{}</span> <span class="p">(</span> <span class="nv">id</span> <span class="o">=</span> <span class="nv">dapp_account</span><span class="p">.</span><span class="nv">account</span><span class="p">.</span><span class="nv">id</span><span class="p">,</span> <span class="nv">first_name</span> <span class="o">=</span> <span class="p">.</span><span class="nv">first_name</span><span class="p">,</span> <span class="nv">last_name</span> <span class="o">=</span> <span class="p">.</span><span class="nv">last_name</span><span class="p">,</span> <span class="nv">age</span> <span class="o">=</span> <span class="p">.</span><span class="nv">age</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Restart the node for changes to take effect. Because we have changed database structure, we need to add <code class="docutils literal notranslate"><span class="pre">-W</span></code> option to delete the database and add new <code class="docutils literal notranslate"><span class="pre">dapp_account</span></code> table:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>postchain/bin/run-node.sh &lt;dapp_name&gt; -W
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Make sure to update your client’s blockchainRID config with the newly generated blockchainRID</p>
</div>
<p>On the client side, operation can be called using <code class="docutils literal notranslate"><span class="pre">ft3-lib</span></code> (or <code class="docutils literal notranslate"><span class="pre">postchain-client</span></code>):</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nx">DirectoryService</span> <span class="nx">from</span> <span class="s1">&#39;./lib/directory-service&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">util</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;postchain-client&#39;</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">blockchainRID</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;../configs/constants&#39;</span><span class="p">;</span>

<span class="k">import</span> <span class="p">{</span>
  <span class="nx">op</span><span class="p">,</span>
  <span class="nx">Blockchain</span><span class="p">,</span>
  <span class="nx">SingleSignatureAuthDescriptor</span><span class="p">,</span>
  <span class="nx">FlagsType</span><span class="p">,</span>
  <span class="nx">User</span>
<span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;ft3-lib&#39;</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">keyPair</span> <span class="o">=</span> <span class="nx">util</span><span class="p">.</span><span class="nx">makeKeyPair</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">(</span>
  <span class="nx">keyPair</span><span class="p">,</span>
  <span class="k">new</span> <span class="nx">SingleSignatureAuthDescriptor</span><span class="p">(</span>
    <span class="nx">keyPair</span><span class="p">.</span><span class="nx">pubKey</span><span class="p">,</span>
    <span class="p">[</span><span class="nx">FlagsType</span><span class="p">.</span><span class="nx">Account</span><span class="p">,</span> <span class="nx">FlagsType</span><span class="p">.</span><span class="nx">Transfer</span><span class="p">]</span>
  <span class="p">)</span>
<span class="p">);</span>

<span class="kd">const</span> <span class="nx">blockchain</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">Blockchain</span><span class="p">.</span><span class="nx">initialize</span><span class="p">(</span>
  <span class="nx">blockchainRID</span><span class="p">,</span>
  <span class="k">new</span> <span class="nx">DirectoryService</span><span class="p">()</span>
<span class="p">);</span>
<span class="kd">const</span> <span class="nx">session</span> <span class="o">=</span> <span class="nx">blockchain</span><span class="p">.</span><span class="nx">newSession</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>

<span class="k">await</span> <span class="nx">session</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">op</span><span class="p">(</span>
  <span class="s1">&#39;create_dapp_account&#39;</span><span class="p">,</span>
  <span class="s1">&#39;John&#39;</span><span class="p">,</span>
  <span class="s1">&#39;Doe&#39;</span><span class="p">,</span>
  <span class="mf">30</span><span class="p">,</span>
  <span class="nx">user</span><span class="p">.</span><span class="nx">authDescriptor</span>
<span class="p">));</span>
</pre></div>
</div>
<p>We can check if <code class="docutils literal notranslate"><span class="pre">create_dapp_account</span></code> operation is executed successfully using <code class="docutils literal notranslate"><span class="pre">get_dapp_accounts</span></code> query we created:</p>
<div class="highlight-js notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span> <span class="nx">rest</span> <span class="o">=</span> <span class="nx">pcl</span><span class="p">.</span><span class="nx">restClient</span><span class="p">.</span><span class="nx">createRestClient</span><span class="p">(</span><span class="nx">nodeApiUrl</span><span class="p">,</span> <span class="nx">blockchainRID</span><span class="p">,</span> <span class="mf">5</span><span class="p">)</span>

<span class="kd">const</span> <span class="nx">gtx</span> <span class="o">=</span> <span class="nx">pcl</span><span class="p">.</span><span class="nx">gtxClient</span><span class="p">.</span><span class="nx">createClient</span><span class="p">(</span>
  <span class="nx">rest</span><span class="p">,</span>
  <span class="nx">Buffer</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span>
    <span class="nx">blockchainRID</span><span class="p">,</span>
    <span class="s1">&#39;hex&#39;</span>
  <span class="p">),</span>
  <span class="p">[]</span>
<span class="p">);</span>

<span class="kd">const</span> <span class="nx">allDappAccoounts</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">gtx</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="s1">&#39;get_dapp_accounts&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="modules">
<h2>Modules<a class="headerlink" href="#modules" title="Permalink to this headline">¶</a></h2>
<p>In this section, we will go through some of the built-in utilities that FT3 modules provide.</p>
<p>It should be noted that the built-in operations and queries all have matching interface in <code class="docutils literal notranslate"><span class="pre">ft3-lib</span></code> <a class="reference internal" href="ft3-javascript-library.html"><span class="doc">javascript library</span></a>.</p>
<div class="section" id="account-module">
<h3>Account Module<a class="headerlink" href="#account-module" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">acc:</span> <span class="pre">.lib.ft3.account;</span></code></p>
<p><strong>Functions:</strong></p>
<div class="highlight-rell notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nv">create_account_with_auth</span> <span class="p">(</span><span class="nv">auth_descriptor</span><span class="p">):</span> <span class="nv">byte_array</span>
</pre></div>
</div>
<p>Create a new FT3 account using the provided <code class="docutils literal notranslate"><span class="pre">ft3.account.auth_descriptor</span></code></p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">auth_descriptor</span></code>: The <code class="docutils literal notranslate"><span class="pre">auth_descriptor</span></code> used to create this account.</p></li>
<li><p>return: <code class="docutils literal notranslate"><span class="pre">account.id</span></code> (equal to <code class="docutils literal notranslate"><span class="pre">auth_descriptor.hash()</span></code>)</p></li>
</ul>
<div class="highlight-rell notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nv">auth_and_log</span><span class="p">(</span><span class="nv">account_id</span><span class="p">:</span> <span class="nv">byte_array</span><span class="p">,</span> <span class="nv">auth_descriptor_id</span><span class="p">:</span> <span class="nv">byte_array</span><span class="p">,</span> <span class="nv">required_flags</span><span class="p">:</span> <span class="k">list</span><span class="o">&lt;</span><span class="nv">text</span><span class="o">&gt;</span><span class="p">):</span> <span class="nv">account</span>
</pre></div>
</div>
<p>Authorize given auth_descriptor for required authorization flags, and apply the rate limiter constrains configurated in <code class="docutils literal notranslate"><span class="pre">config.template.xml</span></code>. This is meant to be the default authorization mechanism for operations.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">account_id</span></code>: id of the account</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">auth_descriptor_id</span></code>: is equal to <code class="docutils literal notranslate"><span class="pre">auth_descriptor.hash()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">required_flags</span></code>: list of required authorization flags (see <a class="reference internal" href="ft3-features.html#ft3-account-management"><span class="std std-ref">Account Management</span></a>)</p></li>
<li><p>return: the account instance</p></li>
</ul>
<div class="highlight-rell notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nv">require_auth</span> <span class="p">(</span><span class="nv">account</span><span class="p">,</span> <span class="nv">descriptor_id</span><span class="p">:</span> <span class="nv">byte_array</span><span class="p">,</span> <span class="nv">required_flags</span><span class="p">:</span> <span class="k">list</span><span class="o">&lt;</span><span class="nv">text</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Authorize given auth_descriptor, but does not apply rate limiter’s constrains.</p>
<div class="highlight-rell notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nv">_add_auth_descriptor</span> <span class="p">(</span><span class="nv">account</span><span class="p">,</span> <span class="nv">auth_descriptor</span><span class="p">)</span>
<span class="k">function</span> <span class="nv">_delete_auth_descriptor</span><span class="p">(</span><span class="nv">auth_descriptor</span><span class="p">:</span> <span class="nv">account_auth_descriptor</span><span class="p">)</span>
<span class="k">function</span> <span class="nv">_delete_all_auth_descriptors_exclude</span><span class="p">(</span><span class="nv">account</span><span class="p">,</span> <span class="nv">auth_descriptor_id</span><span class="p">:</span> <span class="nv">byte_array</span><span class="p">)</span>
</pre></div>
</div>
<p>Utilities for managing auth_descriptors.</p>
<p><strong>Operations:</strong></p>
<div class="highlight-rell notranslate"><div class="highlight"><pre><span></span><span class="k">operation</span> <span class="nv">delete_auth_descriptor</span> <span class="p">(</span><span class="nv">account_id</span><span class="p">:</span> <span class="nv">byte_array</span><span class="p">,</span> <span class="nv">auth_descriptor_id</span><span class="p">:</span> <span class="nv">byte_array</span><span class="p">,</span> <span class="nv">delete_descriptor_id</span><span class="p">:</span> <span class="nv">byte_array</span><span class="p">)</span>

<span class="k">operation</span> <span class="nv">delete_all_auth_descriptors_exclude</span><span class="p">(</span><span class="nv">account_id</span><span class="p">:</span> <span class="nv">byte_array</span><span class="p">,</span> <span class="nv">auth_descriptor_id</span><span class="p">:</span> <span class="nv">byte_array</span><span class="p">)</span>

<span class="k">operation</span> <span class="nv">add_auth_descriptor</span> <span class="p">(</span><span class="nv">account_id</span><span class="p">:</span> <span class="nv">byte_array</span><span class="p">,</span> <span class="nv">auth_id</span><span class="p">:</span> <span class="nv">byte_array</span><span class="p">,</span> <span class="nv">new_desc</span><span class="p">:</span> <span class="nv">acc</span><span class="p">.</span><span class="nv">auth_descriptor</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Queries:</strong></p>
<div class="highlight-rell notranslate"><div class="highlight"><pre><span></span><span class="k">query</span> <span class="nv">get_account_auth_descriptors</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="nv">byte_array</span><span class="p">)</span>

<span class="k">query</span> <span class="nv">get_account_by_id</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="nv">byte_array</span><span class="p">)</span>

<span class="k">query</span> <span class="nv">get_account_by_auth_descriptor</span><span class="p">(</span><span class="nv">auth_descriptor</span><span class="p">)</span>

<span class="k">query</span> <span class="nv">get_accounts_by_participant_id</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span> <span class="nv">byte_array</span><span class="p">)</span>

<span class="k">query</span> <span class="nv">get_accounts_by_auth_descriptor_id</span><span class="p">(</span><span class="nv">descriptor_id</span><span class="p">:</span> <span class="nv">byte_array</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="core-module">
<h3>Core Module<a class="headerlink" href="#core-module" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">core:</span> <span class="pre">.lib.ft3.core;</span></code></p>
<p><strong>Functions:</strong></p>
<div class="highlight-rell notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nv">register_asset</span> <span class="p">(</span><span class="nv">name</span><span class="p">,</span> <span class="nv">issuing_chain_rid</span><span class="p">:</span> <span class="nv">byte_array</span><span class="p">):</span> <span class="nv">asset</span>
</pre></div>
</div>
<p>Register a new asset on the chain.</p>
<div class="highlight-rell notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nv">_get_asset_balances</span><span class="p">(</span><span class="nv">account_id</span><span class="p">:</span> <span class="nv">byte_array</span><span class="p">):</span> <span class="k">list</span><span class="o">&lt;</span><span class="p">(</span><span class="nv">id</span><span class="p">:</span><span class="nv">byte_array</span><span class="p">,</span><span class="nv">name</span><span class="p">:</span><span class="nv">text</span><span class="p">,</span><span class="nv">amount</span><span class="p">:</span><span class="nv">integer</span><span class="p">,</span><span class="nv">chain_id</span><span class="p">:</span><span class="nv">byte_array</span><span class="p">)</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Get asset balance of an account.</p>
<div class="highlight-rell notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nv">ensure_balance</span><span class="p">(</span><span class="nv">acc</span><span class="p">.</span><span class="nv">account</span><span class="p">,</span> <span class="nv">asset</span><span class="p">):</span> <span class="nv">balance</span>
</pre></div>
</div>
<p>Get account’s balance of an asset, or create one if it doesn’t exist.</p>
<div class="highlight-rell notranslate"><div class="highlight"><pre><span></span><span class="k">struct</span> <span class="nv">xfer_input</span> <span class="p">{</span>
  <span class="nv">account_id</span><span class="p">:</span> <span class="nv">byte_array</span><span class="p">;</span>
  <span class="nv">asset_id</span><span class="p">:</span> <span class="nv">byte_array</span><span class="p">;</span>
  <span class="nv">auth_descriptor_id</span><span class="p">:</span> <span class="nv">byte_array</span><span class="p">;</span>
  <span class="nv">amount</span><span class="p">:</span> <span class="nv">integer</span><span class="p">;</span>
  <span class="nv">extra</span><span class="p">:</span> <span class="k">map</span><span class="o">&lt;</span><span class="nv">text</span><span class="p">,</span> <span class="nv">gtv</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="nv">xfer_output</span> <span class="p">{</span>
  <span class="nv">account_id</span><span class="p">:</span> <span class="nv">byte_array</span><span class="p">;</span>
  <span class="nv">asset_id</span><span class="p">:</span> <span class="nv">byte_array</span><span class="p">;</span>
  <span class="nv">amount</span><span class="p">:</span> <span class="nv">integer</span><span class="p">;</span>
  <span class="nv">extra</span><span class="p">:</span> <span class="k">map</span><span class="o">&lt;</span><span class="nv">text</span><span class="p">,</span> <span class="nv">gtv</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nv">_transfer</span> <span class="p">(</span><span class="nv">inputs</span><span class="p">:</span> <span class="k">list</span><span class="o">&lt;</span><span class="nv">xfer_input</span><span class="o">&gt;</span><span class="p">,</span> <span class="nv">outputs</span><span class="p">:</span> <span class="k">list</span><span class="o">&lt;</span><span class="nv">xfer_output</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p>Perform an asset transfer from accounts described in <code class="docutils literal notranslate"><span class="pre">xfer_input</span></code> to accounts in <code class="docutils literal notranslate"><span class="pre">xfer_output</span></code>.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">xfer_output.extra</span></code> map contains a <code class="docutils literal notranslate"><span class="pre">reg_auth_desc</span></code> key, then the value will be used as <code class="docutils literal notranslate"><span class="pre">auth_descriptor</span></code> to create a new account (meaning you can create a new account then transfer asset to it immediately in one transaction).</p>
<p>Using the transaction function in Rell could look something like this:</p>
<div class="highlight-rell notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="nv">transfer_balance</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="nv">user_account</span><span class="p">,</span>    <span class="c1">//user_account being an entity with an acc.account attribute.</span>
                          <span class="nv">from_auth</span><span class="p">:</span> <span class="nv">acc</span><span class="p">.</span><span class="nv">auth_descriptor</span>
                          <span class="nv">to</span><span class="p">:</span> <span class="nv">user_account</span><span class="p">,</span> <span class="nv">to_auth</span><span class="p">:</span> <span class="nv">acc</span><span class="p">.</span><span class="nv">auth_descriptor</span><span class="p">,</span>
                          <span class="nv">amount</span><span class="p">:</span><span class="nv">integer</span><span class="p">){</span>
    <span class="k">val</span> <span class="nv">input</span> <span class="o">=</span> <span class="nv">ft3</span><span class="p">.</span><span class="nv">xfer_input</span><span class="p">(</span><span class="nv">account_id</span> <span class="o">=</span> <span class="nv">from</span><span class="p">.</span><span class="nv">account</span><span class="p">.</span><span class="nv">id</span>
                               <span class="nv">asset_id</span> <span class="o">=</span> <span class="nv">exampleToken</span><span class="p">.</span><span class="nv">token</span><span class="p">.</span><span class="nv">id</span><span class="p">,</span>
                               <span class="nv">auth_descriptor_id</span> <span class="o">=</span> <span class="nv">from_auth</span><span class="p">,</span>
                               <span class="nv">amount</span> <span class="o">=</span> <span class="nv">amount</span><span class="p">,</span>
                               <span class="nv">extra</span> <span class="o">=</span> <span class="k">map</span><span class="o">&lt;</span><span class="nv">text</span><span class="p">,</span> <span class="nv">gtv</span><span class="o">&gt;</span><span class="p">()</span>
                               <span class="p">);</span>
    <span class="k">val</span> <span class="nv">output</span> <span class="o">=</span> <span class="nv">ft3</span><span class="p">.</span><span class="nv">xfer_input</span><span class="p">(</span><span class="nv">account_id</span> <span class="o">=</span> <span class="nv">to</span><span class="p">.</span><span class="nv">account</span><span class="p">.</span><span class="nv">id</span><span class="p">,</span>
                                <span class="nv">asset_id</span> <span class="o">=</span> <span class="nv">exampleToken</span><span class="p">.</span><span class="nv">token</span><span class="p">.</span><span class="nv">id</span><span class="p">,</span>
                                <span class="nv">auth_descriptor_id</span> <span class="o">=</span> <span class="nv">to_auth</span><span class="p">,</span>
                                <span class="nv">amount</span> <span class="o">=</span> <span class="nv">amount</span><span class="p">,</span>
                                <span class="nv">extra</span> <span class="o">=</span> <span class="k">map</span><span class="o">&lt;</span><span class="nv">text</span><span class="p">,</span> <span class="nv">gtv</span><span class="o">&gt;</span><span class="p">()</span>
                             <span class="p">);</span>
     <span class="k">val</span> <span class="nv">inputs</span> <span class="o">=</span> <span class="k">list</span><span class="o">&lt;</span><span class="nv">ft3</span><span class="p">.</span><span class="nv">xfer_input</span><span class="o">&gt;</span><span class="p">();</span>
     <span class="nv">inputs</span><span class="p">.</span><span class="nv">add</span><span class="p">(</span><span class="nv">input</span><span class="p">);</span>
     <span class="nv">outputs</span><span class="p">.</span><span class="nv">add</span><span class="p">(</span><span class="nv">output</span><span class="p">);</span>
     <span class="nv">ft3</span><span class="p">.</span><span class="nv">_transfer</span><span class="p">(</span><span class="nv">inputs</span><span class="p">,</span> <span class="nv">outputs</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Operations:</strong></p>
<div class="highlight-rell notranslate"><div class="highlight"><pre><span></span><span class="k">operation</span> <span class="nv">transfer</span> <span class="p">(</span><span class="nv">inputs</span><span class="p">:</span> <span class="k">list</span><span class="o">&lt;</span><span class="nv">ft3</span><span class="p">.</span><span class="nv">xfer_input</span><span class="o">&gt;</span><span class="p">,</span> <span class="nv">outputs</span><span class="p">:</span> <span class="k">list</span><span class="o">&lt;</span><span class="nv">ft3</span><span class="p">.</span><span class="nv">xfer_output</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Queries:</strong></p>
<div class="highlight-rell notranslate"><div class="highlight"><pre><span></span><span class="k">query</span> <span class="nv">get_asset_balances</span><span class="p">(</span><span class="nv">account_id</span><span class="p">:</span> <span class="nv">byte_array</span><span class="p">)</span>

<span class="k">query</span> <span class="nv">get_asset_balance</span><span class="p">(</span><span class="nv">account_id</span><span class="p">:</span> <span class="nv">byte_array</span><span class="p">,</span> <span class="nv">asset_id</span><span class="p">:</span> <span class="nv">byte_array</span><span class="p">)</span>

<span class="k">query</span> <span class="nv">get_asset_by_name</span><span class="p">(</span><span class="nv">name</span><span class="p">)</span>

<span class="k">query</span> <span class="nv">get_asset_by_id</span><span class="p">(</span><span class="nv">asset_id</span><span class="p">:</span> <span class="nv">byte_array</span><span class="p">)</span>

<span class="k">query</span> <span class="nv">get_all_assets</span><span class="p">()</span>

<span class="k">query</span> <span class="nv">get_payment_history</span><span class="p">(</span><span class="nv">account_id</span><span class="p">:</span> <span class="nv">byte_array</span><span class="p">,</span> <span class="nv">after_block</span><span class="p">:</span> <span class="nv">integer</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="ft3-single-sign-on.html" class="btn btn-neutral float-right" title="Single Sign-on (SSO)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="ft3-javascript-library.html" class="btn btn-neutral float-left" title="Javascript library" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
    <script src="../_static/side-nav-icons.js"></script>
    <script src="../_static/dark-mode-on-load.js"></script>
    <script src="../_static/get-news.js"></script>


</body>
</html>